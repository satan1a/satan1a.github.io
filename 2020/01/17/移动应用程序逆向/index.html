<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="移动应用程序逆向移动应用逆向分析自己预习的内容 破解Android程序的通常方法将apk文件利用ApkTool（Android反编译工具）进行反编译，生成Smali格式的反汇编代码，然后阅读Smali文件的代码来理解程序的运行机制，找到程序的突破口进行修改，最后使用ApkTool重新编译生产apk文件并签名，最后运行测试，如此循环，直至程序被成功破解。    反编译——理解运行机制——找突破口进行">
<meta property="og:type" content="article">
<meta property="og:title" content="移动应用程序逆向">
<meta property="og:url" content="https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/index.html">
<meta property="og:site_name" content="喵了个咪乎 Cat My Dog">
<meta property="og:description" content="移动应用程序逆向移动应用逆向分析自己预习的内容 破解Android程序的通常方法将apk文件利用ApkTool（Android反编译工具）进行反编译，生成Smali格式的反汇编代码，然后阅读Smali文件的代码来理解程序的运行机制，找到程序的突破口进行修改，最后使用ApkTool重新编译生产apk文件并签名，最后运行测试，如此循环，直至程序被成功破解。    反编译——理解运行机制——找突破口进行">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114091238.png">
<meta property="og:image" content="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114105225.png">
<meta property="og:image" content="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114105700.png">
<meta property="og:image" content="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114110036.png">
<meta property="og:image" content="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114113611.png">
<meta property="og:image" content="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114114413.png">
<meta property="og:image" content="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114114548.png">
<meta property="og:image" content="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114141547.png">
<meta property="og:image" content="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114141813.png">
<meta property="article:published_time" content="2020-01-17T03:36:46.000Z">
<meta property="article:modified_time" content="2020-01-17T03:38:15.000Z">
<meta property="article:author" content="Toky">
<meta property="article:tag" content="Cyber Security">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114091238.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>移动应用程序逆向</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="喵了个咪乎 Cat My Dog" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/Project">Projects</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="https://y1ng.cc/" target="_blank" rel="noopener">BBS</a></li>
         
          <li><a href="/books">Books</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/02/01/%E6%83%85%E6%8A%A5%E5%AD%A6%E4%B9%A0%E6%8A%80%E8%83%BD%E6%A0%91/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/01/15/%E7%A7%BB%E5%8A%A8%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%8F%8A%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&text=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&title=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&is_video=false&description=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=移动应用程序逆向&body=Check out this article: https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&title=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&title=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&title=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&title=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&name=移动应用程序逆向&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&t=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#移动应用程序逆向"><span class="toc-number">1.</span> <span class="toc-text">移动应用程序逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#移动应用逆向分析"><span class="toc-number">1.1.</span> <span class="toc-text">移动应用逆向分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#自己预习的内容"><span class="toc-number">1.1.1.</span> <span class="toc-text">自己预习的内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Why-Android"><span class="toc-number">1.1.2.</span> <span class="toc-text">Why Android?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#逆向Android的目的？"><span class="toc-number">1.1.3.</span> <span class="toc-text">逆向Android的目的？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#认识APK文件"><span class="toc-number">1.1.4.</span> <span class="toc-text">认识APK文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Android-应用的逆向技术和方法"><span class="toc-number">2.</span> <span class="toc-text">Android 应用的逆向技术和方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#逆技"><span class="toc-number">2.1.</span> <span class="toc-text">逆技</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#逆向流程"><span class="toc-number">2.2.</span> <span class="toc-text">逆向流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-反编译"><span class="toc-number">2.2.1.</span> <span class="toc-text">1. 反编译</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dex"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">dex</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#arm"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">arm</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-关键字定位"><span class="toc-number">2.2.2.</span> <span class="toc-text">2. 关键字定位</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#关键字定位"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">关键字定位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#资源定位"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">资源定位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#日志定位"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">日志定位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#调用栈跟踪"><span class="toc-number">2.2.2.4.</span> <span class="toc-text">调用栈跟踪</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-核心目标逆向"><span class="toc-number">2.2.3.</span> <span class="toc-text">3. 核心目标逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#静态分析"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">静态分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#动态调试"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">动态调试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#动静结合"><span class="toc-number">2.2.3.3.</span> <span class="toc-text">动静结合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#扩展"><span class="toc-number">2.2.4.</span> <span class="toc-text">扩展</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Android应用安全保护和对抗"><span class="toc-number">3.</span> <span class="toc-text">Android应用安全保护和对抗</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#如何保护？"><span class="toc-number">3.1.</span> <span class="toc-text">如何保护？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-干扰反编译工具"><span class="toc-number">3.2.</span> <span class="toc-text">1. 干扰反编译工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#利用反编译工具的bug或漏洞"><span class="toc-number">3.2.1.</span> <span class="toc-text">利用反编译工具的bug或漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#转换成代码时的漏洞"><span class="toc-number">3.2.2.</span> <span class="toc-text">转换成代码时的漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#链接资源文件时的bug"><span class="toc-number">3.2.3.</span> <span class="toc-text">链接资源文件时的bug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#例子"><span class="toc-number">3.2.4.</span> <span class="toc-text">例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对抗-gt-干扰反编译"><span class="toc-number">3.2.5.</span> <span class="toc-text">对抗-&gt;干扰反编译</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-代码混淆"><span class="toc-number">3.3.</span> <span class="toc-text">2. 代码混淆</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#将代码变得难以阅读"><span class="toc-number">3.3.1.</span> <span class="toc-text">将代码变得难以阅读</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#变量名、类名、方法名混淆"><span class="toc-number">3.3.2.</span> <span class="toc-text">变量名、类名、方法名混淆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串加密"><span class="toc-number">3.3.3.</span> <span class="toc-text">字符串加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#控制流混淆-平坦"><span class="toc-number">3.3.4.</span> <span class="toc-text">控制流混淆&#x2F;平坦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#控制流平坦化（比较高级）"><span class="toc-number">3.3.5.</span> <span class="toc-text">控制流平坦化（比较高级）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码混淆工具"><span class="toc-number">3.3.6.</span> <span class="toc-text">代码混淆工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Java工具"><span class="toc-number">3.3.6.1.</span> <span class="toc-text">Java工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#C-代码"><span class="toc-number">3.3.6.2.</span> <span class="toc-text">C++代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#混淆的问题和使用场景"><span class="toc-number">3.3.7.</span> <span class="toc-text">混淆的问题和使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#混淆带来的问题"><span class="toc-number">3.3.7.1.</span> <span class="toc-text">混淆带来的问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#什么APP会使用混淆"><span class="toc-number">3.3.7.2.</span> <span class="toc-text">什么APP会使用混淆?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#对抗代码混淆"><span class="toc-number">3.3.7.3.</span> <span class="toc-text">对抗代码混淆</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#扩展-1"><span class="toc-number">3.4.</span> <span class="toc-text">扩展</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-反调试"><span class="toc-number">3.5.</span> <span class="toc-text">3. 反调试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ptrace"><span class="toc-number">3.5.1.</span> <span class="toc-text">Ptrace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#检测调试器"><span class="toc-number">3.5.2.</span> <span class="toc-text">检测调试器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于时间的检测"><span class="toc-number">3.5.3.</span> <span class="toc-text">基于时间的检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对抗反调试"><span class="toc-number">3.5.4.</span> <span class="toc-text">对抗反调试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-加壳与脱壳"><span class="toc-number">3.6.</span> <span class="toc-text">4. 加壳与脱壳</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#加固"><span class="toc-number">3.6.1.</span> <span class="toc-text">加固</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Dex加固"><span class="toc-number">3.6.1.1.</span> <span class="toc-text">Dex加固</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#So加固"><span class="toc-number">3.6.1.2.</span> <span class="toc-text">So加固</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加固后APK运行过程"><span class="toc-number">3.6.2.</span> <span class="toc-text">加固后APK运行过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#脱壳"><span class="toc-number">3.6.3.</span> <span class="toc-text">脱壳</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Dex脱壳"><span class="toc-number">3.6.3.1.</span> <span class="toc-text">Dex脱壳</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#So脱壳"><span class="toc-number">3.6.3.2.</span> <span class="toc-text">So脱壳</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#移动应用第三方加固方案分析"><span class="toc-number">3.7.</span> <span class="toc-text">移动应用第三方加固方案分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#目的"><span class="toc-number">3.8.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#例题（GeekPWN）"><span class="toc-number">3.9.</span> <span class="toc-text">例题（GeekPWN）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#考察点"><span class="toc-number">3.9.1.</span> <span class="toc-text">考察点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida使用"><span class="toc-number">3.10.</span> <span class="toc-text">Frida使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Frida无法使用的原因"><span class="toc-number">3.10.1.</span> <span class="toc-text">Frida无法使用的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook不上的几种原因"><span class="toc-number">3.10.2.</span> <span class="toc-text">Hook不上的几种原因</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何做安全研究？"><span class="toc-number">3.11.</span> <span class="toc-text">如何做安全研究？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#保持一份热情"><span class="toc-number">3.11.1.</span> <span class="toc-text">保持一份热情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#持续的学习"><span class="toc-number">3.11.2.</span> <span class="toc-text">持续的学习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#深度决定了广度"><span class="toc-number">3.11.3.</span> <span class="toc-text">深度决定了广度</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        移动应用程序逆向
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">喵了个咪乎 Cat My Dog</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-01-17T03:36:46.000Z" itemprop="datePublished">2020-01-17</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="移动应用程序逆向"><a href="#移动应用程序逆向" class="headerlink" title="移动应用程序逆向"></a>移动应用程序逆向</h1><h2 id="移动应用逆向分析"><a href="#移动应用逆向分析" class="headerlink" title="移动应用逆向分析"></a>移动应用逆向分析</h2><h3 id="自己预习的内容"><a href="#自己预习的内容" class="headerlink" title="自己预习的内容"></a>自己预习的内容</h3><ol>
<li>破解Android程序的通常方法<br>将apk文件利用ApkTool（Android反编译工具）进行反编译，生成Smali格式的反汇编代码，然后阅读Smali文件的代码来理解程序的运行机制，找到程序的突破口进行修改，最后使用ApkTool重新编译生产apk文件并签名，最后运行测试，如此循环，直至程序被成功破解。  </li>
</ol>
<p>反编译——理解运行机制——找突破口进行修改——重新编译——再签名——运行测试——循环往复  </p>
<h3 id="Why-Android"><a href="#Why-Android" class="headerlink" title="Why Android?"></a>Why Android?</h3><p>APP-移动互联网的入口<br>安全研究的“交集”<br>Android的市场份额 —— 和iOS其实是相通的</p>
<h3 id="逆向Android的目的？"><a href="#逆向Android的目的？" class="headerlink" title="逆向Android的目的？"></a>逆向Android的目的？</h3><p>遇到的问题：<br>代码混淆<br>反调试<br>加壳</p>
<h3 id="认识APK文件"><a href="#认识APK文件" class="headerlink" title="认识APK文件"></a>认识APK文件</h3><p><img src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114091238.png"><br>1.AndroidMainfest</p>
<ul>
<li>XML格式</li>
<li>二进制数据存储</li>
<li>内容：<ul>
<li>包名、名称、图标、targetSDK、版本号等；</li>
<li>需要的权限列表（安全研究时用得少，恶意代码分析用得多）；</li>
<li>使用的组件信息（Activity，Service，Broadcast Receiver，Content Provider）<ul>
<li>Activity：可视的界面；生命周期、启动模式</li>
<li>Service：服务，前台和后台</li>
<li>BroadCast Receiver</li>
<li>Content Provider：内容提供者：URI，增删改查</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>2.lib —— Native代码编译后的库、第三方库<br>3.res —— 资源文件<br>4.assets —— 音频、视频、图片等静态文件（有些加壳后存放到这个）</p>
<hr>
<p>1.DEX文件</p>
<ul>
<li>Java -&gt; dex</li>
<li>dex.035 文件头，可以通过这个来找</li>
</ul>
<p>2.SO文件</p>
<ul>
<li>C/C++编译后的文件（elf格式）</li>
<li>JNI</li>
<li>第三方库（opencv，unity）</li>
<li>架构：armeabi…</li>
</ul>
<p>3.签名文件</p>
<ul>
<li>防止被篡改</li>
<li>APP升级（判断是否是正确的升级包）</li>
<li>代码或数据共享（e.g.只给自己共享，不给别的APP共享）</li>
<li>文件结构：<ul>
<li>META-INF目录</li>
<li>MANIFEST.MF    所有文件的SHA1/SHA256的Base64编码</li>
<li>CERT.ST    MANIFEST.MF文件的SHA1/SHA256的Base64编码</li>
<li>CERT.RSA/.DSA    签名的公钥，SF签名后的数据</li>
</ul>
</li>
</ul>
<p>这是V1方式，这里也是一个漏洞利用点。正当用途：APP分发到各个市场的分发计费</p>
<hr>
<h1 id="Android-应用的逆向技术和方法"><a href="#Android-应用的逆向技术和方法" class="headerlink" title="Android 应用的逆向技术和方法"></a>Android 应用的逆向技术和方法</h1><h2 id="逆技"><a href="#逆技" class="headerlink" title="逆技"></a>逆技</h2><p>逆技：一机（一台Root后的手机，小米有开发版本的root系统）；一APK；一椅（一逆逆一天）；一钛合金眼</p>
<h2 id="逆向流程"><a href="#逆向流程" class="headerlink" title="逆向流程"></a>逆向流程</h2><p>反编译 ——&gt; 目标定位 &lt;——&gt; 核心目标逆向</p>
<h3 id="1-反编译"><a href="#1-反编译" class="headerlink" title="1. 反编译"></a>1. 反编译</h3><h4 id="dex"><a href="#dex" class="headerlink" title="dex"></a>dex</h4><ul>
<li>dex -&gt; smali<ul>
<li>baksmail [TOOL]</li>
</ul>
</li>
<li>dex -&gt; smali -&gt;java<ul>
<li>jeb</li>
<li>Apktool (前者结合用，Smali代码是不会有错的，伪Java可能会错)</li>
<li>dex2jar</li>
</ul>
</li>
</ul>
<h4 id="arm"><a href="#arm" class="headerlink" title="arm"></a>arm</h4><ul>
<li>elf -&gt; arm指令<ul>
<li>IDA</li>
<li>Radare2 （NSA放出来的工具） [TOOL]</li>
<li>Ghidra</li>
</ul>
</li>
<li>Arm指令 -&gt; C++<ul>
<li>IDA F5</li>
<li>Ghidra</li>
</ul>
</li>
</ul>
<h3 id="2-关键字定位"><a href="#2-关键字定位" class="headerlink" title="2. 关键字定位"></a>2. 关键字定位</h3><p>关键字定位<br>资源定位<br>日志定位<br>调用栈跟踪</p>
<h4 id="关键字定位"><a href="#关键字定位" class="headerlink" title="关键字定位"></a>关键字定位</h4><p>1.字符关键字<br>2.代码关键字<br>3.Grep大法好</p>
<ul>
<li>反编译后的静态代码</li>
<li>动态加载的代码（不一定找得到，也是代码保护的一个手段）</li>
<li>监控文件变化</li>
</ul>
<h4 id="资源定位"><a href="#资源定位" class="headerlink" title="资源定位"></a>资源定位</h4><p>1.定位UI中的资源变量名（如红包的LOGO），例如红包按钮为“a77”</p>
<ul>
<li>ddms</li>
<li>uiautomatorviewer</li>
<li>dumpsys</li>
</ul>
<p>2.res目录中寻找该变量对应的索引值<br>3.在Smali代码中grep所有对该索引值的引用</p>
<h4 id="日志定位"><a href="#日志定位" class="headerlink" title="日志定位"></a>日志定位</h4><p>1.adb logcat | grep</p>
<p>2.日志文件</p>
<ul>
<li>APP目录下</li>
<li>SDcard</li>
</ul>
<p>3.打开APP内置的日志开关（开发人员在开发时为方便调试打开的，几乎所有的APP都有，<strong>非常好用</strong>）</p>
<ul>
<li>重打包</li>
<li>hook</li>
</ul>
<p>4.Smali注入</p>
<ul>
<li>污点跟踪</li>
<li>数据流分析</li>
</ul>
<h4 id="调用栈跟踪"><a href="#调用栈跟踪" class="headerlink" title="调用栈跟踪"></a>调用栈跟踪</h4><p>1.ddms method profiling<br>2.hook系统函数打印callback（相当于是录像一样</p>
<h3 id="3-核心目标逆向"><a href="#3-核心目标逆向" class="headerlink" title="3. 核心目标逆向"></a>3. 核心目标逆向</h3><h4 id="静态分析"><a href="#静态分析" class="headerlink" title="静态分析"></a>静态分析</h4><p>1.直接分析smali代码<br>类<br>基本数据类型<br>寄存器<br>函数和函数调用<br>代码块和跳转</p>
<p>2.分析伪java代码  </p>
<p>3.直接分析arm指令</p>
<ul>
<li>寄存器 SP, PC, LR </li>
<li>传参方式 返回值一般在R0</li>
<li>跳转 B, BL, BX, BLX</li>
<li>存储器访问 LTR, STR等</li>
<li>数据处理</li>
<li>armh和thumb切换</li>
</ul>
<p>4.分析伪C++代码</p>
<h4 id="动态调试"><a href="#动态调试" class="headerlink" title="动态调试"></a>动态调试</h4><p>1.AS无源码调试 [TODO，昨天的实验]</p>
<ul>
<li>配置APP为可调试状态</li>
<li>反编译APK将smali导入AS工程（安装Smalidea插件）</li>
<li>新建remote调试，并配置好端口</li>
<li>以调试模式启动APP，开始调试</li>
</ul>
<p>2.IDA调试 Android SO [TODO, 同样是昨天的实验]</p>
<ul>
<li>IDA导入SO文件</li>
<li>root设备上启动android_server<ul>
<li>adb push/chmod</li>
</ul>
</li>
<li>IDA新建Remote Android Debuger<ul>
<li>adb forward tcp:23946 tcp:23946</li>
</ul>
</li>
<li>选取目标进程，断点调试</li>
</ul>
<p>3.Smali代码注入（插桩）</p>
<ul>
<li>注入方法：反编译——修改Smali代码——重打包</li>
<li>使用场景：<ul>
<li>批量打印logo</li>
<li>控制流分析</li>
<li>数据流分析</li>
</ul>
</li>
<li>问题</li>
<li>重打包失败</li>
<li>签名检查</li>
<li>寄存器维护（和重打包失败一致）</li>
</ul>
<p>4.HOOK技术</p>
<ul>
<li>使用场景<ul>
<li>注入到目标代码，改变执行结果</li>
<li>获取某一状态下的变量值</li>
</ul>
</li>
<li>HOOK本质（要理解工具、技术的本质，再去使用）<ul>
<li>代码注入</li>
</ul>
</li>
<li>HOOK工具<ul>
<li>Xposed —— 替换app_process（所有进程的母进程）</li>
<li>Frida —— Ptrace注入 [TODO，后面去研究一下]<img src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114105225.png" style="zoom: 33%;" />
图：Xposed和Frida对比
</li>
</ul>
</li>
</ul>
<ol start="5">
<li>使用Frida Hook APP</li>
</ol>
<ul>
<li><p>注入原理</p>
<img src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114105700.png" style="zoom:50%;" />
</li>
<li><p>使用场景</p>
<ul>
<li>设备root</li>
<li>非root</li>
</ul>
</li>
<li><p>两种模式</p>
<ul>
<li>Attach 已有进程上附加，适合已运行的服务上，尤其是一些系统服务</li>
<li>Spawn 新起一个进程，适合进程刚启动时</li>
</ul>
</li>
<li><p>例子</p>
<img src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114110036.png" style="zoom:50%;" />

</li>
</ul>
<h4 id="动静结合"><a href="#动静结合" class="headerlink" title="动静结合"></a>动静结合</h4><h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>扩：腾讯玄武安全实验室，应用克隆</p>
<hr>
<h1 id="Android应用安全保护和对抗"><a href="#Android应用安全保护和对抗" class="headerlink" title="Android应用安全保护和对抗"></a>Android应用安全保护和对抗</h1><h2 id="如何保护？"><a href="#如何保护？" class="headerlink" title="如何保护？"></a>如何保护？</h2><p>反编译（干扰反编译工具）—— 目标定位（代码混淆） —— 核心目标逆向（代码混淆、反调试、加壳）</p>
<h2 id="1-干扰反编译工具"><a href="#1-干扰反编译工具" class="headerlink" title="1. 干扰反编译工具"></a>1. 干扰反编译工具</h2><h3 id="利用反编译工具的bug或漏洞"><a href="#利用反编译工具的bug或漏洞" class="headerlink" title="利用反编译工具的bug或漏洞"></a>利用反编译工具的bug或漏洞</h3><ul>
<li>AndroidManifest.xml</li>
<li>dex</li>
<li>So</li>
</ul>
<h3 id="转换成代码时的漏洞"><a href="#转换成代码时的漏洞" class="headerlink" title="转换成代码时的漏洞"></a>转换成代码时的漏洞</h3><ul>
<li>Smali -&gt; Java</li>
<li>Arm指令 -&gt; C++</li>
</ul>
<h3 id="链接资源文件时的bug"><a href="#链接资源文件时的bug" class="headerlink" title="链接资源文件时的bug"></a>链接资源文件时的bug</h3><ul>
<li>特殊的资源文件</li>
<li>超长的资源id</li>
</ul>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><img src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114113611.png" style="zoom:33%;" />

<h3 id="对抗-gt-干扰反编译"><a href="#对抗-gt-干扰反编译" class="headerlink" title="对抗-&gt;干扰反编译"></a>对抗-&gt;干扰反编译</h3><p>1.反编译时不链接资源文件 –no-resource<br>2.使用新版本的反编译工具<br>3.分析底层的反编译代码</p>
<ul>
<li>Smali</li>
<li>Arm指令 </li>
</ul>
<p>4.打造自己的逆向工具链（强联推荐，在对抗时，甚至是开发自己的反编译工具）</p>
<h2 id="2-代码混淆"><a href="#2-代码混淆" class="headerlink" title="2. 代码混淆"></a>2. 代码混淆</h2><h3 id="将代码变得难以阅读"><a href="#将代码变得难以阅读" class="headerlink" title="将代码变得难以阅读"></a>将代码变得难以阅读</h3><ul>
<li>变量名、类名、方法名混淆</li>
<li>字符串加密</li>
<li>控制流混淆</li>
</ul>
<h3 id="变量名、类名、方法名混淆"><a href="#变量名、类名、方法名混淆" class="headerlink" title="变量名、类名、方法名混淆"></a>变量名、类名、方法名混淆</h3><ul>
<li>超长名字 00o0ooo00ooo000ooo</li>
<li>相似字符 mabin -&gt; m4bln</li>
<li>特定含义的代码 int int= 5</li>
<li>特殊编码 ȷava \u0237</li>
<li>难以阅读的字符</li>
</ul>
<h3 id="字符串加密"><a href="#字符串加密" class="headerlink" title="字符串加密"></a>字符串加密</h3><ul>
<li>编码：ascii码、Base64、Unicode</li>
<li>自己实现的字符串加密<br><img src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114114413.png"></li>
</ul>
<h3 id="控制流混淆-平坦"><a href="#控制流混淆-平坦" class="headerlink" title="控制流混淆/平坦"></a>控制流混淆/平坦</h3><ul>
<li>运算混淆 a+b-&gt;a+c/d–c/d+b</li>
<li>控制流伪造</li>
</ul>
<h3 id="控制流平坦化（比较高级）"><a href="#控制流平坦化（比较高级）" class="headerlink" title="控制流平坦化（比较高级）"></a>控制流平坦化（比较高级）</h3><ul>
<li>工具：OLLVM</li>
<li>原理：利用分发器，树立代码，通过分发器来控制代码流程，让线性的代码平坦化</li>
<li><img src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114114548.png" style="zoom:50%;" /> 


</li>
</ul>
<h3 id="代码混淆工具"><a href="#代码混淆工具" class="headerlink" title="代码混淆工具"></a>代码混淆工具</h3><h4 id="Java工具"><a href="#Java工具" class="headerlink" title="Java工具"></a>Java工具</h4><ul>
<li>ProGuard</li>
<li>DexGuard</li>
</ul>
<h4 id="C-代码"><a href="#C-代码" class="headerlink" title="C++代码"></a>C++代码</h4><p>工具：OLLVM</p>
<h3 id="混淆的问题和使用场景"><a href="#混淆的问题和使用场景" class="headerlink" title="混淆的问题和使用场景"></a>混淆的问题和使用场景</h3><h4 id="混淆带来的问题"><a href="#混淆带来的问题" class="headerlink" title="混淆带来的问题"></a>混淆带来的问题</h4><ul>
<li>运行不稳定</li>
<li>开发调试困难</li>
<li>执行效率低</li>
</ul>
<h4 id="什么APP会使用混淆"><a href="#什么APP会使用混淆" class="headerlink" title="什么APP会使用混淆?"></a>什么APP会使用混淆?</h4><ul>
<li>受众基础大的APP不会使用“变态”的混淆方式 • 即使混淆，也只是一小部分核心逻辑</li>
<li>老版本的APP一般不会混淆</li>
<li>纯混淆的CTF题目很无聊</li>
<li>企业级的APP</li>
</ul>
<h4 id="对抗代码混淆"><a href="#对抗代码混淆" class="headerlink" title="对抗代码混淆"></a>对抗代码混淆</h4><p>1.变量名、类名、方法名混淆</p>
<ul>
<li>变量重命名 jeb、重打包</li>
<li>寻找老版本app</li>
<li>根据开源代码映射</li>
<li>自动化 -&gt; 自动化相似代码检测</li>
</ul>
<p>2.字符串加密</p>
<ul>
<li>静态分析替换</li>
<li>动态hook</li>
</ul>
<p>3.控制流混淆</p>
<ul>
<li>优化反编译工具</li>
<li>符号执行</li>
<li>硬核逆向 状态机、经验、耐心</li>
</ul>
<h2 id="扩展-1"><a href="#扩展-1" class="headerlink" title="扩展"></a>扩展</h2><p>扩：15年iOS系统解析字符串时，系统崩溃，<a href="https://www.zhihu.com/question/21568134" target="_blank" rel="noopener">参考</a><br>扩：[重要]一些加了混淆的APP，可以去查看其老版本，老版本由于成本等问题，一般不会混淆，这是一个很好的入手点！</p>
<h2 id="3-反调试"><a href="#3-反调试" class="headerlink" title="3. 反调试"></a>3. 反调试</h2><h3 id="Ptrace"><a href="#Ptrace" class="headerlink" title="Ptrace"></a>Ptrace</h3><ul>
<li><p>先占坑：自己ptrace自己</p>
</li>
<li><p>检测TracePid的值<br>/proc/pid/status和/proc/pid/task/pid/status:普<br>通状态下，TracerPid这项应该为0;调试状态下 为调试进程的PID</p>
</li>
</ul>
<h3 id="检测调试器"><a href="#检测调试器" class="headerlink" title="检测调试器"></a>检测调试器</h3><ul>
<li><p>进程名</p>
<ul>
<li>gdb_server</li>
<li>android-server</li>
</ul>
</li>
<li><p>端口号</p>
<ul>
<li>IDA: 23946</li>
<li>Frida: 27042</li>
</ul>
</li>
<li><p>内存特征码</p>
</li>
</ul>
<h3 id="基于时间的检测"><a href="#基于时间的检测" class="headerlink" title="基于时间的检测"></a>基于时间的检测</h3><p>检测程序自身是不是被下了断点，正在被调试。现实中用得比较少。</p>
<h3 id="对抗反调试"><a href="#对抗反调试" class="headerlink" title="对抗反调试"></a>对抗反调试</h3><ul>
<li>找到所有的检测点并Patch（一个个绕过）</li>
<li>抢占先机式的Hook</li>
<li>开启上帝模式 – 修改系统 （打造自己的工具链时会用到）</li>
</ul>
<h2 id="4-加壳与脱壳"><a href="#4-加壳与脱壳" class="headerlink" title="4. 加壳与脱壳"></a>4. 加壳与脱壳</h2><h3 id="加固"><a href="#加固" class="headerlink" title="加固"></a>加固</h3><h4 id="Dex加固"><a href="#Dex加固" class="headerlink" title="Dex加固"></a>Dex加固</h4><ul>
<li>指令抽取</li>
<li>Dex加密<ul>
<li><img src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114141547.png"> </li>
</ul>
</li>
<li>Java-&gt;C</li>
</ul>
<h4 id="So加固"><a href="#So加固" class="headerlink" title="So加固"></a>So加固</h4><ul>
<li>有源码<ul>
<li>vmp</li>
</ul>
</li>
<li>无源码<ul>
<li>So加密</li>
<li>Section加密</li>
</ul>
</li>
</ul>
<h3 id="加固后APK运行过程"><a href="#加固后APK运行过程" class="headerlink" title="加固后APK运行过程"></a>加固后APK运行过程</h3><p>Process.start-&gt;Application创建-&gt;attachBaseContext-&gt;onCreate-&gt;onStart-&gt;onResume-&gt;Activity生命周期</p>
<img src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200114141813.png" style="zoom: 33%;" />

<ol>
<li>入口在壳dex处,获取“执行 权”</li>
<li>壳dex初始化</li>
<li>解密加固的dex</li>
<li>调用DexClassLoader加载解<br>密后的dex</li>
<li>“执行权”还给原dex</li>
</ol>
<h3 id="脱壳"><a href="#脱壳" class="headerlink" title="脱壳"></a>脱壳</h3><h4 id="Dex脱壳"><a href="#Dex脱壳" class="headerlink" title="Dex脱壳"></a>Dex脱壳</h4><ul>
<li><p>Hook dex加载函数</p>
</li>
<li><p>Dump内存重建dex</p>
</li>
<li><p>定制化系统</p>
</li>
<li><p>脱壳工具</p>
<ul>
<li>dumpDex</li>
<li>FDex2</li>
<li>Frida</li>
</ul>
</li>
</ul>
<h4 id="So脱壳"><a href="#So脱壳" class="headerlink" title="So脱壳"></a>So脱壳</h4><ul>
<li><p>解密so</p>
<ul>
<li>hook loader</li>
<li>修复section</li>
<li>dump内存</li>
</ul>
</li>
<li><p>vmp</p>
<ul>
<li>硬逆</li>
<li>状态机</li>
<li>虚拟机入口</li>
</ul>
</li>
</ul>
<h2 id="移动应用第三方加固方案分析"><a href="#移动应用第三方加固方案分析" class="headerlink" title="移动应用第三方加固方案分析"></a>移动应用第三方加固方案分析</h2><p><a href="https://www.cnblogs.com/baiqiantao/p/9286449.html" target="_blank" rel="noopener">https://www.cnblogs.com/baiqiantao/p/9286449.html</a></p>
<h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>建立体系架构，遇到的知识点归纳到这边，这样逆向起来会非常轻松</p>
<h2 id="例题（GeekPWN）"><a href="#例题（GeekPWN）" class="headerlink" title="例题（GeekPWN）"></a>例题（GeekPWN）</h2><h3 id="考察点"><a href="#考察点" class="headerlink" title="考察点"></a>考察点</h3><p>1.包名<br>2.签名原理<br>3.障眼法、干扰<br>4.文件判断（信息搜集）<br>5.编程能力</p>
<p>WP：安全客/84837 无人机的钥匙</p>
<h2 id="Frida使用"><a href="#Frida使用" class="headerlink" title="Frida使用"></a>Frida使用</h2><h3 id="Frida无法使用的原因"><a href="#Frida无法使用的原因" class="headerlink" title="Frida无法使用的原因"></a>Frida无法使用的原因</h3><p>1.root<br>2.selinux（一般需要关闭）<br>3.bug（在GitHub上的issues上）</p>
<h3 id="Hook不上的几种原因"><a href="#Hook不上的几种原因" class="headerlink" title="Hook不上的几种原因"></a>Hook不上的几种原因</h3><p>1.进程没有选对<br>2.动态加载的dex（插件化）<br>3.语法错误</p>
<h2 id="如何做安全研究？"><a href="#如何做安全研究？" class="headerlink" title="如何做安全研究？"></a>如何做安全研究？</h2><h3 id="保持一份热情"><a href="#保持一份热情" class="headerlink" title="保持一份热情"></a>保持一份热情</h3><h3 id="持续的学习"><a href="#持续的学习" class="headerlink" title="持续的学习"></a>持续的学习</h3><ul>
<li>安全咨询 <a href="https://sec.today/pulses/" target="_blank" rel="noopener">sec.today</a> Twitter</li>
<li>安全社区 看雪，吾爱破解，freebuf</li>
<li>安全风向 google/apple 漏洞公告、工业界（BlackHat）学术界会议（四大峰会）</li>
</ul>
<h3 id="深度决定了广度"><a href="#深度决定了广度" class="headerlink" title="深度决定了广度"></a>深度决定了广度</h3><ul>
<li><p>刨根问底<br>e.g. 深入学习完Android后，再学习iOS会非常轻松</p>
</li>
<li><p>沉得住气</p>
</li>
<li><p>善于思考、总结、沉淀</p>
</li>
<li><p>写博客</p>
</li>
</ul>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/Project">Projects</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="https://y1ng.cc/" target="_blank" rel="noopener">BBS</a></li>
         
          <li><a href="/books">Books</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#移动应用程序逆向"><span class="toc-number">1.</span> <span class="toc-text">移动应用程序逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#移动应用逆向分析"><span class="toc-number">1.1.</span> <span class="toc-text">移动应用逆向分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#自己预习的内容"><span class="toc-number">1.1.1.</span> <span class="toc-text">自己预习的内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Why-Android"><span class="toc-number">1.1.2.</span> <span class="toc-text">Why Android?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#逆向Android的目的？"><span class="toc-number">1.1.3.</span> <span class="toc-text">逆向Android的目的？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#认识APK文件"><span class="toc-number">1.1.4.</span> <span class="toc-text">认识APK文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Android-应用的逆向技术和方法"><span class="toc-number">2.</span> <span class="toc-text">Android 应用的逆向技术和方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#逆技"><span class="toc-number">2.1.</span> <span class="toc-text">逆技</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#逆向流程"><span class="toc-number">2.2.</span> <span class="toc-text">逆向流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-反编译"><span class="toc-number">2.2.1.</span> <span class="toc-text">1. 反编译</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dex"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">dex</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#arm"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">arm</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-关键字定位"><span class="toc-number">2.2.2.</span> <span class="toc-text">2. 关键字定位</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#关键字定位"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">关键字定位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#资源定位"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">资源定位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#日志定位"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">日志定位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#调用栈跟踪"><span class="toc-number">2.2.2.4.</span> <span class="toc-text">调用栈跟踪</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-核心目标逆向"><span class="toc-number">2.2.3.</span> <span class="toc-text">3. 核心目标逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#静态分析"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">静态分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#动态调试"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">动态调试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#动静结合"><span class="toc-number">2.2.3.3.</span> <span class="toc-text">动静结合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#扩展"><span class="toc-number">2.2.4.</span> <span class="toc-text">扩展</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Android应用安全保护和对抗"><span class="toc-number">3.</span> <span class="toc-text">Android应用安全保护和对抗</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#如何保护？"><span class="toc-number">3.1.</span> <span class="toc-text">如何保护？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-干扰反编译工具"><span class="toc-number">3.2.</span> <span class="toc-text">1. 干扰反编译工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#利用反编译工具的bug或漏洞"><span class="toc-number">3.2.1.</span> <span class="toc-text">利用反编译工具的bug或漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#转换成代码时的漏洞"><span class="toc-number">3.2.2.</span> <span class="toc-text">转换成代码时的漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#链接资源文件时的bug"><span class="toc-number">3.2.3.</span> <span class="toc-text">链接资源文件时的bug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#例子"><span class="toc-number">3.2.4.</span> <span class="toc-text">例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对抗-gt-干扰反编译"><span class="toc-number">3.2.5.</span> <span class="toc-text">对抗-&gt;干扰反编译</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-代码混淆"><span class="toc-number">3.3.</span> <span class="toc-text">2. 代码混淆</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#将代码变得难以阅读"><span class="toc-number">3.3.1.</span> <span class="toc-text">将代码变得难以阅读</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#变量名、类名、方法名混淆"><span class="toc-number">3.3.2.</span> <span class="toc-text">变量名、类名、方法名混淆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串加密"><span class="toc-number">3.3.3.</span> <span class="toc-text">字符串加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#控制流混淆-平坦"><span class="toc-number">3.3.4.</span> <span class="toc-text">控制流混淆&#x2F;平坦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#控制流平坦化（比较高级）"><span class="toc-number">3.3.5.</span> <span class="toc-text">控制流平坦化（比较高级）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码混淆工具"><span class="toc-number">3.3.6.</span> <span class="toc-text">代码混淆工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Java工具"><span class="toc-number">3.3.6.1.</span> <span class="toc-text">Java工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#C-代码"><span class="toc-number">3.3.6.2.</span> <span class="toc-text">C++代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#混淆的问题和使用场景"><span class="toc-number">3.3.7.</span> <span class="toc-text">混淆的问题和使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#混淆带来的问题"><span class="toc-number">3.3.7.1.</span> <span class="toc-text">混淆带来的问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#什么APP会使用混淆"><span class="toc-number">3.3.7.2.</span> <span class="toc-text">什么APP会使用混淆?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#对抗代码混淆"><span class="toc-number">3.3.7.3.</span> <span class="toc-text">对抗代码混淆</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#扩展-1"><span class="toc-number">3.4.</span> <span class="toc-text">扩展</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-反调试"><span class="toc-number">3.5.</span> <span class="toc-text">3. 反调试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ptrace"><span class="toc-number">3.5.1.</span> <span class="toc-text">Ptrace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#检测调试器"><span class="toc-number">3.5.2.</span> <span class="toc-text">检测调试器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于时间的检测"><span class="toc-number">3.5.3.</span> <span class="toc-text">基于时间的检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对抗反调试"><span class="toc-number">3.5.4.</span> <span class="toc-text">对抗反调试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-加壳与脱壳"><span class="toc-number">3.6.</span> <span class="toc-text">4. 加壳与脱壳</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#加固"><span class="toc-number">3.6.1.</span> <span class="toc-text">加固</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Dex加固"><span class="toc-number">3.6.1.1.</span> <span class="toc-text">Dex加固</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#So加固"><span class="toc-number">3.6.1.2.</span> <span class="toc-text">So加固</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加固后APK运行过程"><span class="toc-number">3.6.2.</span> <span class="toc-text">加固后APK运行过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#脱壳"><span class="toc-number">3.6.3.</span> <span class="toc-text">脱壳</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Dex脱壳"><span class="toc-number">3.6.3.1.</span> <span class="toc-text">Dex脱壳</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#So脱壳"><span class="toc-number">3.6.3.2.</span> <span class="toc-text">So脱壳</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#移动应用第三方加固方案分析"><span class="toc-number">3.7.</span> <span class="toc-text">移动应用第三方加固方案分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#目的"><span class="toc-number">3.8.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#例题（GeekPWN）"><span class="toc-number">3.9.</span> <span class="toc-text">例题（GeekPWN）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#考察点"><span class="toc-number">3.9.1.</span> <span class="toc-text">考察点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida使用"><span class="toc-number">3.10.</span> <span class="toc-text">Frida使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Frida无法使用的原因"><span class="toc-number">3.10.1.</span> <span class="toc-text">Frida无法使用的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook不上的几种原因"><span class="toc-number">3.10.2.</span> <span class="toc-text">Hook不上的几种原因</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何做安全研究？"><span class="toc-number">3.11.</span> <span class="toc-text">如何做安全研究？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#保持一份热情"><span class="toc-number">3.11.1.</span> <span class="toc-text">保持一份热情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#持续的学习"><span class="toc-number">3.11.2.</span> <span class="toc-text">持续的学习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#深度决定了广度"><span class="toc-number">3.11.3.</span> <span class="toc-text">深度决定了广度</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&text=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&title=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&is_video=false&description=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=移动应用程序逆向&body=Check out this article: https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&title=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&title=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&title=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&title=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&name=移动应用程序逆向&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://y1ng.org/2020/01/17/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91/&t=移动应用程序逆向" target="_blank" rel="noopener"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 Toky
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/Project">Projects</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="https://y1ng.cc/" target="_blank" rel="noopener">BBS</a></li>
         
          <li><a href="/books">Books</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-157954403-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'Y1NG.ORG';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


</body>
</html>
